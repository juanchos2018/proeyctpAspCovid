
@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Material Dashboard by Creative Tim
    </title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->

    <link href="~/Scripts/css/material-dashboard.css" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->

    <link href="~/Scripts/css/demo.css" rel="stylesheet" />

</head>

<body class="">
    <div class="wrapper ">
        <div class="sidebar" data-color="purple" data-background-color="white" data-image="../assets/img/sidebar-1.jpg">

            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text logo-normal">
                    Sisetema

                </a>

            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li class="nav-item active ">
                        <a class="nav-link" href="~/Archivo/Index">
                            <i class="material-icons">dashboard</i>
                            <p>Archivo</p>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a class="nav-link" href="~/CasoReportado/Index">
                            <i class="material-icons">dashboard</i>
                            <p>Casos</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="~/Donacion/Index">
                            <i class="material-icons">dashboard</i>
                            <p>Donacion</p>
                        </a>
                    </li>

                    <li class="nav-item ">
                        <a class="nav-link" href="~/Usuario/Index">
                            <i class="material-icons">dashboard</i>
                            <p>Usuario</p>
                        </a>
                    </li>

                    <li class="nav-item  ">
                        <a class="nav-link" href="~/Usuario/Cerrar">
                            <i class="material-icons">dashboard</i>
                            <p>Salir</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <div class="content">

                <!-- DataTales Example -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Noticias</h6>
                        <button class="btn btn-success float-right" type="button" data-toggle="modal" data-target="#AgregarNoticia">
                            <i class="fas fa-newspaper"></i> Nuevo Noticia
                        </button>
                    </div>
                    <div class="card-body">
                        <table id="tabla" class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>descriopcion</th>
                                    <th>foto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>


            </div>

            <!-- TERMINA  el Contenido -->
        </div>
    </div>



    <!-- Modal Register -->
    <div class="modal fade" id="AgregarNoticia" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Noticia</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">

                        <div class="col-xl-4">
                            <div class="card">
                                <div class="card-header">Imagen Producto</div>
                                <div class="card-body text-center">
                                    <img class="borrar" id="imgFoto" width="100" height="100" style="border: 1px solid" />
                                    <div class="small font-italic text-muted mb-4">Recomendación 300x300</div>
                                    <div class="">
                                        <input type="file" class="borrar form-control" id="fileToUpload">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8">
                            <div class="card mb-4">
                                <div class="card-header">Agregar Noticia</div>
                                <div class="card-body">
                                    <form action="/" method="post">


                                        <div class="form-group">
                                            <label>Descripcion</label>
                                            <input class="borrar form-control" id="txtdescripcion" type="text" placeholder="Descripcion">
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnCancelar" type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                        <button type="button" id="btnSave" class="btn btn-success">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Register -->
    <div class="modal fade" id="ModificarNoticia" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Noticia</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">

                        <div class="col-xl-4">
                            <div class="card">
                                <div class="card-header">Imagen Producto</div>
                                <div class="card-body text-center">
                                    <input type="text"  hidden="" id="keynoticia" width="100"  />
                                    <img class="borrar" id="imgFoto" width="100" height="100" style="border: 1px solid" />
                                    <div class="small font-italic text-muted mb-4">Recomendación 300x300</div>
                                    <div class="">
                                        <input type="file" class="borrar form-control" id="fileToUpload1">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8">
                            <div class="card mb-4">
                                <div class="card-header">Modicar Noticia</div>
                                <div class="card-body">
                                    <form action="/" method="post">
                                        <div class="form-group">
                                            <label>Descripcion</label>
                                            <input class="borrar form-control" id="txtdescripcion1" type="text" placeholder="Descripcion">
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="btnCancelar" type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                        <button type="button" id="btnSave1" class="btn btn-success">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="~/Scripts/js/demo.js"></script>
    <script src="~/Scripts/jquery-3.5.1.js"></script>
    <script src="~/Scripts/js/bootstrap.min.js"></script>

</body>

</html>


<script>

    $(document).ready(function () {
        listaNoticias();
    })

    function listaNoticias() {
      //  alert("hola");
        $.ajax({

            type: "GET",
            url: '/Archivo/Get_Noticias/',
            contentType: "application/json",
            success: function (data) {
                console.log(data);
                var rows = '';
                $.each(data, function (i, item) {
                    rows += "<tr>"
                    rows += "<td>" + item.descripcion + "</td>"
                    rows += "<td>" + item.fecha + "</td>"
                    rows += "<td > <img src= " + item.ruta + " witdh='100' height='100'  >  </td>"

                    rows += "<td> <button type='button' id='btnedit' class='btn btn-primary' onclick='modificar(/" + item.key + "/)' >Editar </button>  <button type='button' id='btneliminar' onclick='eliminar(/" + item.key   +"/)' class='btn btn-primary' '>Eliminar </button>    </td>"

                    rows += "</tr>";
                    rows += "</tr>";
                    $("#tabla tbody").html(rows);
                });
            }

        })
    }

    function modificar(key_noticia) {




        var id_c = String(key_noticia).replace(/\/+/g, "");
        $("#keynoticia").val(id_c);
        $("#ModificarNoticia").modal("show");

    }


    $("#btnSave").click(function () {

        if (window.FormData == undefined)
            alert("Error: FormData is undefined");

        else {

          
            var fileData = new FormData();
            // para los productos
            var fileUpload = $("#fileToUpload").get(0);
            var descripcion = $("#txtdescripcion").val();  

            var files = fileUpload.files;
            fileData.append(files[0].name, files[0]);
            fileData.append("txtdescripcion", descripcion);       

            $.ajax({
                url: '/Archivo/CreateNoticia',
                type: 'post',
                datatype: 'json',
                contentType: false,
                processData: false,
                async: false,
                data: fileData,
                success: function (response) {

                    $("#AgregarNoticia").modal("hide");
                    alert("agreado");

               //     $("#ModalCheck").modal("show");
                    //   listaProductos();

                },
                error: function (xhr, status) {
                    alert('Disculpe, existió un problema');
                },
            });
        }

    });



    $("#btnSave1").click(function () {

        if (window.FormData == undefined)
            alert("Error: FormData is undefined");

        else {

            var fileData = new FormData();
            // para los productos
            var fileUpload = $("#fileToUpload1").get(0);
            var descripcion = $("#txtdescripcion1").val();
            var key = $("#keynoticia").val();
            var files = fileUpload.files;
            fileData.append(files[0].name, files[0]);
            fileData.append("key", key);
            fileData.append("descripcion", descripcion);

            $.ajax({
                url: '/Archivo/ModificarNoticia/',
                type: 'post',
                datatype: 'json',
                contentType: false,
                processData: false,
                async: false,
                data: fileData,
                success: function (response) {
                    listaNoticias();

                    $("#ModificarNoticia").modal("hide");
                    alert("Modificado");


                },
                error: function (xhr, status) {
                    alert('Disculpe, existió un problema');
                },
            });
        }

    });


    function eliminar(key_noticia) {
         var id_c = String(key_noticia).replace(/\/+/g, "");
        $.ajax({
            url: '/Archivo/Eliminar/?key_noticia=' + id_c,
            type: 'post',
            datatype: 'json',
           
            success: function (response) {
                listaNoticias();
               
                alert("Eliminado");                

            },
            error: function (xhr, status) {
                alert('Disculpe, existió un problema');
            },
        });

    }

</script>